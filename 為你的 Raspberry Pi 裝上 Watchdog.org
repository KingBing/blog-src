#+TITLE: 為你的 Raspberry Pi 裝上 Watchdog
#+AUTHOR: coldnew
#+EMAIL:  coldnew.tw@gmail.com
#+DATE:   2013-12-13 22:28:00
#+LANGUAGE: zh_TW
#+URL:    b1756
#+OPTIONS: num:nil ^:nil
#+TAGS: raspberry_pi watchdog linux


你是否遇過 Raspberry Pi 異常死掉呢? 我遇過，而且非常多次


會造成 Raspberry Pi 當掉的原因有很多，比如電源供電不足、電源線阻抗
太大，造成提供的電壓不夠、有零件故障、瑕疵品......等，可能的原因很多，
有興趣的話使用 *Raspberry Pi freeze* 這樣的關鍵字去收尋，就可找到非常
多的討論串。


那既然手邊的 Raspberry Pi 會當掉，那要怎辦呢？總不能一旦他掛掉，就手動
重新啟動吧? 這時候就是 =watchdog= 出馬的時候啦 ~

Watchdog，中文譯為看門狗，這是一種用於判斷系統是否有正常運作的程式，每
隔固定的間隔就會運作，若系統異常，則重啟系統。

Raspberry Pi 使用的 BCM2708 SOC 內建有硬體版的 watchdog 模組，我們可以透
過 Linux Kernel 的 =bcm2708_wdog= 模組來控制 Raspberry Pi 的 watchdog，
達到當機後進行重新開機的功能。

* 開機後自動載入 watchdog 模組

要啟用 watchdog 功能，首先要記得載入相對應的 kernel module，因此我們編
輯 =/etc/modules= ，並將裡面內容修改成如下

#+BEGIN_SRC sh
  # /etc/modules: kernel modules to load at boot time.
  #
  # This file contains the names of kernel modules that should be loaded
  # at boot time, one per line. Lines beginning with "#" are ignored.
  # Parameters can be specified after the module name.

  snd-bcm2835
  bcm2708_wdog
#+END_SRC

當然如果希望馬上就啟用 watchdog，而不是等到下次重開機後才有用的話，則要
記得手動載入模組

#+BEGIN_EXAMPLE
  root@raspberrypi:/home/pi# modprobe bcm2708_wdog
#+END_EXAMPLE
